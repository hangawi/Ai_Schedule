/**
 * OCR ì´ë¯¸ì§€ ë¶„ì„ í›„ ì±„íŒ… ê¸°ë°˜ í•„í„°ë§ í”„ë¡¬í”„íŠ¸ (ì¡°ê±´ ê¸°ë°˜)
 */

function generateOcrChatPrompt(chatMessage, extractedSchedules, schedulesByImage = null, imageDescription = '') {
  // ì´ë¯¸ì§€ë³„ ì •ë³´ ìƒì„±
  let imageInfoText = '';
  if (schedulesByImage && schedulesByImage.length > 0) {
    imageInfoText = '\n## ğŸ“¸ ì´ë¯¸ì§€ë³„ ìŠ¤ì¼€ì¤„ ì •ë³´\n\n';
    schedulesByImage.forEach((imageData, idx) => {
      const uniqueClasses = [...new Set(imageData.schedules.map(s => s.title))];
      imageInfoText += `### ì´ë¯¸ì§€ ${idx + 1} (${imageData.fileName}):\n`;
      imageInfoText += `- ìˆ˜ì—… ê°œìˆ˜: ${imageData.schedules.length}ê°œ\n`;
      imageInfoText += `- ë°œê²¬ëœ ë°˜: ${uniqueClasses.join(', ')}\n\n`;
    });
  }

  return `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ OCR ì‹œê°„í‘œ í•„í„°ë§ ì¡°ê±´ ë¶„ì„ ì‹œìŠ¤í…œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## ì—­í• 
ë‹¹ì‹ ì€ ì‚¬ìš©ìì˜ ì±„íŒ… ë©”ì‹œì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì‹œê°„í‘œ í•„í„°ë§ ì¡°ê±´ì„ ì¶”ì¶œí•˜ëŠ” AIì…ë‹ˆë‹¤.

ğŸš¨ ì¤‘ìš”: ë‹¹ì‹ ì€ ìŠ¤ì¼€ì¤„ ê°ì²´ë¥¼ ì§ì ‘ ë§Œë“¤ì§€ ì•ŠìŠµë‹ˆë‹¤!
ë‹¹ì‹ ì˜ ì—­í• ì€ ì˜¤ì§ "ì–´ë–¤ ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§í• ì§€" ì¡°ê±´ë§Œ ë¶„ì„í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

## ìƒí™©
- ì‚¬ìš©ìê°€ ì‹œê°„í‘œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí–ˆìŠµë‹ˆë‹¤
- OCRë¡œ ì´ ${extractedSchedules.length}ê°œì˜ ìˆ˜ì—…ì´ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤
- ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ìˆ˜ì—…ë§Œ ì„ íƒí•˜ë ¤ê³  í•©ë‹ˆë‹¤

${imageDescription ? `
## ì´ë¯¸ì§€ ì •ë³´
${imageDescription}
` : ''}

${imageInfoText}

## ì‚¬ìš©ì ì±„íŒ… ë©”ì‹œì§€
"${chatMessage}"

## ìŠ¤ì¼€ì¤„ ë°ì´í„° êµ¬ì¡° ì˜ˆì‹œ
ê° ìŠ¤ì¼€ì¤„ ê°ì²´ëŠ” ë‹¤ìŒ í•„ë“œë¥¼ ê°€ì§‘ë‹ˆë‹¤:
- title: ìˆ˜ì—…ëª… (ì˜ˆ: "ë„ë•", "ì£¼ë‹ˆì–´A", "KPOP")
- days: ìš”ì¼ ë°°ì—´ (ì˜ˆ: ["MON"], ["MON","WED","FRI"])
- startTime: ì‹œì‘ì‹œê°„ (ì˜ˆ: "09:00")
- endTime: ì¢…ë£Œì‹œê°„ (ì˜ˆ: "09:50")
- sourceImageIndex: ì´ë¯¸ì§€ ë²ˆí˜¸ (0ë¶€í„° ì‹œì‘)
- instructor: ê°•ì‚¬ëª… (ì—†ìœ¼ë©´ null)
- gradeLevel: í•™ë…„ (ì˜ˆ: "elementary")

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ í•„í„°ë§ ì¡°ê±´ ë¶„ì„ ê°€ì´ë“œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### í•™êµ/í•™ì› êµ¬ë¶„
- "í•™êµ ì‹œê°„í‘œ" = ê³¼ëª©ëª…ì´ ë„ë•, ìˆ˜í•™, ìŒì•…, ì˜ì–´ ë“± â†’ ë³´í†µ sourceImageIndex: 0
- "í•™ì› ì‹œê°„í‘œ" = ë°˜ ì´ë¦„ì´ ì£¼ë‹ˆì–´A, KPOP ë“± â†’ ë³´í†µ sourceImageIndex: 1

### í•µì‹¬ í‚¤ì›Œë“œ
1. **"ì „ì²´", "ì „ë¶€", "ë‹¤", "ëª¨ë‘"** â†’ ì¡°ê±´ì— ë§ëŠ” **ëª¨ë“ ** ìŠ¤ì¼€ì¤„
2. **"~ë§Œ", "only"** â†’ íŠ¹ì • ì¡°ê±´ë§Œ
3. **"í•™êµ"** â†’ í•™êµ ì‹œê°„í‘œ ì´ë¯¸ì§€ì˜ ìŠ¤ì¼€ì¤„ë“¤
4. **"í•™ì›"** â†’ í•™ì› ì‹œê°„í‘œ ì´ë¯¸ì§€ì˜ ìŠ¤ì¼€ì¤„ë“¤

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¤ JSON ì‘ë‹µ í˜•ì‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### 1ï¸âƒ£ í•„í„°ë§ ì¡°ê±´ ë°˜í™˜ (action: "filter")

{
  "understood": "ì‚¬ìš©ì ì˜ë„ ìš”ì•½",
  "action": "filter",
  "conditions": [
    {
      "type": "imageIndex",
      "value": 0,
      "mode": "all",
      "description": "í•™êµ ì‹œê°„í‘œ ì „ì²´"
    },
    {
      "type": "titleMatch",
      "keywords": ["ì£¼ë‹ˆì–´", "A", "ì‚¬ë‘"],
      "matchAll": true,
      "imageIndex": 1,
      "description": "í•™ì›ì—ì„œ ì£¼ë‹ˆì–´A ì‚¬ë‘ ì„ ìƒë‹˜"
    }
  ],
  "explanation": "í•™êµ ì‹œê°„í‘œ ì „ì²´ì™€ í•™ì› ì£¼ë‹ˆì–´A ì‚¬ë‘ ì„ ìƒë‹˜ ë°˜ì„ ì„ íƒí–ˆì–´ìš”!"
}

### 2ï¸âƒ£ ì§ˆë¬¸ í•„ìš” (action: "question")

{
  "understood": "ì‚¬ìš©ì ì˜ë„ ìš”ì•½",
  "action": "question",
  "conditions": [],
  "explanation": "ì–´ë–¤ ìˆ˜ì—…ì„ ì›í•˜ì‹œë‚˜ìš”? í˜„ì¬ ì´ë¯¸ì§€ 1ì—ëŠ” í•™êµ ê³¼ëª©ë“¤ì´, ì´ë¯¸ì§€ 2ì—ëŠ” í•™ì› ë°˜ë“¤ì´ ìˆì–´ìš”."
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ ì¡°ê±´ íƒ€ì… ì„¤ëª…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### type: "imageIndex"
íŠ¹ì • ì´ë¯¸ì§€ì˜ ìŠ¤ì¼€ì¤„ ì„ íƒ
- value: ì´ë¯¸ì§€ ë²ˆí˜¸ (0, 1, 2...)
- mode: "all" (ì „ì²´) ë˜ëŠ” "none"

ì˜ˆì‹œ: "í•™êµ ì‹œê°„í‘œ ì „ì²´" â†’ { type: "imageIndex", value: 0, mode: "all" }

### type: "titleMatch"
ì œëª©ìœ¼ë¡œ í•„í„°ë§
- keywords: ê²€ìƒ‰í•  í‚¤ì›Œë“œ ë°°ì—´
- matchAll: trueë©´ ëª¨ë“  í‚¤ì›Œë“œ í¬í•¨, falseë©´ í•˜ë‚˜ë¼ë„ í¬í•¨
- imageIndex: (ì„ íƒ) íŠ¹ì • ì´ë¯¸ì§€ì—ì„œë§Œ ì°¾ê¸°

ì˜ˆì‹œ: "ì£¼ë‹ˆì–´A ì‚¬ë‘" â†’ { type: "titleMatch", keywords: ["ì£¼ë‹ˆì–´", "A", "ì‚¬ë‘"], matchAll: true, imageIndex: 1 }

### type: "timeRange"
ì‹œê°„ëŒ€ë¡œ í•„í„°ë§
- startAfter: ì´ ì‹œê°„ ì´í›„ (ì˜ˆ: "15:00")
- endBefore: ì´ ì‹œê°„ ì´ì „ (ì˜ˆ: "19:00")
- imageIndex: (ì„ íƒ) íŠ¹ì • ì´ë¯¸ì§€ì—ì„œë§Œ ì°¾ê¸°

ì˜ˆì‹œ: "í•™ì› ì˜¤í›„ 5ì‹œ ì´í›„" â†’ { type: "timeRange", startAfter: "17:00", imageIndex: 1 }
ì˜ˆì‹œ: "ì €ë… 6ì‹œ ì „ê¹Œì§€" â†’ { type: "timeRange", endBefore: "18:00", imageIndex: 1 }

### type: "dayMatch"
ìš”ì¼ë¡œ í•„í„°ë§
- days: ìš”ì¼ ë°°ì—´ (ì˜ˆ: ["MON", "WED", "FRI"])
- imageIndex: (ì„ íƒ) íŠ¹ì • ì´ë¯¸ì§€ì—ì„œë§Œ ì°¾ê¸°

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ ì˜ˆì‹œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

### ì˜ˆì‹œ 1: "í•™êµì‹œê°„í‘œëŠ” ì „ë¶€ìˆ˜í–‰í• ê±°ê³  í•™ì›ì€ ì£¼ë‹ˆì–´ a ì‚¬ë‘ì„ ìƒë‹˜ë§Œ í• ê±°ì•¼"

ë¶„ì„:
- "í•™êµì‹œê°„í‘œëŠ” ì „ë¶€" â†’ ì´ë¯¸ì§€ë³„ ì •ë³´ë¥¼ ë³´ë‹ˆ ì´ë¯¸ì§€ 1ì´ í•™êµ â†’ sourceImageIndex: 0 ì „ì²´
- "í•™ì›ì€ ì£¼ë‹ˆì–´ a ì‚¬ë‘ì„ ìƒë‹˜ë§Œ" â†’ ì´ë¯¸ì§€ 2ê°€ í•™ì› â†’ sourceImageIndex: 1ì—ì„œ titleì— "ì£¼ë‹ˆì–´", "A", "ì‚¬ë‘" í¬í•¨

ì‘ë‹µ:
{
  "understood": "í•™êµ ì‹œê°„í‘œ ì „ì²´ + í•™ì› ì£¼ë‹ˆì–´A ì‚¬ë‘ ì„ ìƒë‹˜ë§Œ",
  "action": "filter",
  "conditions": [
    {
      "type": "imageIndex",
      "value": 0,
      "mode": "all",
      "description": "í•™êµ ì‹œê°„í‘œ ì „ì²´"
    },
    {
      "type": "titleMatch",
      "keywords": ["ì£¼ë‹ˆì–´", "ì‚¬ë‘"],
      "matchAll": true,
      "imageIndex": 1,
      "description": "í•™ì› ì£¼ë‹ˆì–´A ì‚¬ë‘ ì„ ìƒë‹˜"
    }
  ],
  "explanation": "í•™êµ ì‹œê°„í‘œ ì „ì²´ì™€ í•™ì› ì£¼ë‹ˆì–´A ì‚¬ë‘ ì„ ìƒë‹˜ ë°˜ì„ ì„ íƒí–ˆì–´ìš”!"
}

### ì˜ˆì‹œ 2: "ê³µì—°ë°˜ë§Œ í• ê±°ì•¼"

ì‘ë‹µ:
{
  "understood": "ê³µì—°ë°˜ ìˆ˜ì—…ë§Œ ì„ íƒ",
  "action": "filter",
  "conditions": [
    {
      "type": "titleMatch",
      "keywords": ["ê³µì—°ë°˜"],
      "matchAll": false
    }
  ],
  "explanation": "ê³µì—°ë°˜ ìˆ˜ì—…ì„ ì„ íƒí–ˆì–´ìš”!"
}

### ì˜ˆì‹œ 3: "ì›”ìˆ˜ê¸ˆ ì˜¤í›„ ìˆ˜ì—…ë§Œ"

ì‘ë‹µ:
{
  "understood": "ì›”ìˆ˜ê¸ˆ ì˜¤í›„ ìˆ˜ì—…ë§Œ",
  "action": "filter",
  "conditions": [
    {
      "type": "dayMatch",
      "days": ["MON", "WED", "FRI"]
    },
    {
      "type": "timeRange",
      "startAfter": "12:00"
    }
  ],
  "explanation": "ì›”ìˆ˜ê¸ˆ ì˜¤í›„ ìˆ˜ì—…ì„ ì„ íƒí–ˆì–´ìš”!"
}

### ì˜ˆì‹œ 4: "í•™êµì‹œê°„í‘œëŠ” ì „ë¶€í• ê±°ê³  í•™ì›ì€ ì˜¤í›„ 5ì‹œ ì´í›„ë¶€í„° ì‹œì‘í• ê±°ì•¼ ê·¸ë¦¬ê³  ì €ë… 6ì‹œì— ë°¥ë¨¹ì„ê±°ë‹ˆê¹Œ ì•Œì•„ì„œ í•´ë†”"

ë¶„ì„:
- "í•™êµì‹œê°„í‘œëŠ” ì „ë¶€" â†’ sourceImageIndex: 0 ì „ì²´
- "í•™ì›ì€ ì˜¤í›„ 5ì‹œ ì´í›„" â†’ sourceImageIndex: 1ì—ì„œ startTime >= "17:00"
- "ì €ë… 6ì‹œì— ë°¥ë¨¹ì„ê±°ë‹ˆê¹Œ" â†’ 18:00~19:00 ì‹œê°„ëŒ€ í”¼í•˜ê¸° (endBefore: "18:00" ë˜ëŠ” startAfter: "19:00")

ì‘ë‹µ:
{
  "understood": "í•™êµ ì‹œê°„í‘œ ì „ì²´ + í•™ì› ì˜¤í›„ 5ì‹œ~ì €ë… 6ì‹œ ì‚¬ì´ ìˆ˜ì—…",
  "action": "filter",
  "conditions": [
    {
      "type": "imageIndex",
      "value": 0,
      "mode": "all",
      "description": "í•™êµ ì‹œê°„í‘œ ì „ì²´"
    },
    {
      "type": "timeRange",
      "startAfter": "17:00",
      "endBefore": "18:00",
      "imageIndex": 1,
      "description": "í•™ì› ì˜¤í›„ 5ì‹œ~ì €ë… 6ì‹œ ì‚¬ì´"
    }
  ],
  "explanation": "í•™êµ ì‹œê°„í‘œ ì „ì²´ì™€ í•™ì› ì˜¤í›„ 5ì‹œ~ì €ë… 6ì‹œ ì‚¬ì´ ìˆ˜ì—…ì„ ì„ íƒí–ˆì–´ìš”!"
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ìœ„ í˜•ì‹ìœ¼ë¡œ JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª…ì€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.
`;
}

module.exports = { generateOcrChatPrompt };
