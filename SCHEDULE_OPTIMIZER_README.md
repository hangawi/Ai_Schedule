# 🤖 스마트 스케줄 최적화 시스템

AI 기반 자동 시간표 생성 및 충돌 해결 시스템

## 📋 개요

OCR로 추출한 여러 시간표에서 겹치는 일정을 자동으로 감지하고, 사용자 맞춤형 질문을 통해 최적의 스케줄을 생성합니다.

## ✨ 주요 기능

### 1. 자동 충돌 감지
- 모든 시간표에서 겹치는 일정 자동 탐지
- 요일별, 시간대별 충돌 분석
- 충돌 유형 분류 (완전 중복, 부분 중복 등)

### 2. 맞춤형 질문 생성
사용자 상황에 맞는 질문을 자동 생성:
- **기본 정보**: 하교 시간, 취침 시간, 이동 시간
- **우선순위**: 필수 학원/과목 선택, 순위 지정
- **선호도**: 휴식 요일, 저녁 시간, 숙제 시간

### 3. AI 기반 최적화
- **Gemini AI** 사용하여 스마트 스케줄 생성
- 학습/운동/예체능 균형 고려
- 이동 시간, 식사 시간 자동 배치
- 여러 대안 제시

### 4. 시각적 결과 표시
- 최적화된 주간 시간표
- 충돌 해결 내역
- 통계 (총 수업 시간, 요일별 분포 등)
- AI의 상세한 설명

## 🎯 사용 시나리오

### 예시: 초등학생 학원 스케줄 최적화

**입력 시간표**:
- 영어학원: 월/수/금 16:00-17:00
- 댄스학원: 월/수/금 19:10-20:10
- 축구학원: 화/목 18:30-19:30
- 학교 시간표: 월~금 09:00-15:00
- 구몬 학습지: 화 16:50-17:20

**충돌 감지**:
- 화요일 영어(17:10-18:10)와 구몬(16:50-17:20)이 겹침
- 일부 요일에 학원이 과도하게 배치됨

**사용자 질문**:
1. 하교 시간은? → 15:00
2. 잠자는 시간은? → 22:00
3. 이동 시간은? → 도보 10분
4. 꼭 해야 하는 학원은? → 영어, 댄스, 축구 모두
5. 우선순위는? → 영어 > 축구 > 댄스
6. 휴식 요일 필요? → 주 1일 (수요일)

**AI 최적화 결과**:
```
✅ 최종 스케줄
월: 하교(15:00) → 숙제(15:30) → 영어(16:00) → 저녁(18:00) → KPOP(19:10)
화: 하교(15:00) → 숙제(15:30) → 구몬(16:50) → 저녁(18:10) → 축구(19:00)
수: 하교(15:00) → 휴식 및 자유시간
목: 하교(15:00) → 숙제(15:30) → 영어(16:00) → 저녁(18:00) → 축구(19:00)
금: 하교(15:00) → 숙제(15:30) → 영어(16:00) → 저녁(18:00) → KPOP(19:10)
토: 가족 시간
일: 휴식

💡 AI 설명:
- 화요일 영어를 제거하여 구몬과 충돌 해결
- 수요일을 휴식 요일로 지정하여 과부하 방지
- 영어는 월/목/금으로 주 3회 유지
- 축구와 댄스를 번갈아 배치하여 체력 관리
```

## 📁 파일 구조

```
client/src/
├── utils/
│   └── scheduleOptimizer.js          # 핵심 로직
│       ├── detectConflicts()          # 충돌 감지
│       ├── generateOptimizationQuestions()  # 질문 생성
│       ├── optimizeScheduleWithGPT()  # AI 최적화
│       └── generateAutoSchedule()     # 규칙 기반 최적화
│
├── components/
│   └── modals/
│       └── ScheduleOptimizerModal.js  # UI 컴포넌트
│           ├── Intro 단계             # 충돌 요약 표시
│           ├── Questions 단계         # 맞춤형 질문
│           ├── Processing 단계        # AI 처리 중
│           └── Result 단계            # 최적화 결과

server/
└── routes/
    └── scheduleOptimizer.js           # 백엔드 API
        └── POST /api/schedule/optimize  # Gemini AI 호출
```

## 🔧 설치 및 설정

### 1. 백엔드 라우트 등록 ✅

`server/index.js`에 추가 (완료):

```javascript
const scheduleOptimizerRoutes = require('./routes/scheduleOptimizer');
app.use('/api/schedule', scheduleOptimizerRoutes);
```

### 2. 환경 변수 설정 ✅

`.env` 파일 (완료):

```
GEMINI_API_KEY=your_gemini_api_key_here
```

### 3. 프론트엔드 통합 ✅

`ScheduleOptimizationModal.js`에서 통합 완료:

```javascript
import ScheduleOptimizerModal from './components/modals/ScheduleOptimizerModal';

// AI 최적화 버튼 클릭 시 자동으로 열림
// 사용자가 시간표 조합을 선택할 때 "AI 자동 최적화" 버튼 표시
```

### 4. 사용 방법

1. **시간표 이미지 업로드**: 여러 학원 시간표 사진을 업로드
2. **조합 확인**: 시스템이 자동으로 최적 조합을 생성
3. **충돌 감지**: 겹치는 일정이 있으면 표시됨
4. **AI 최적화**: "AI 자동 최적화" 버튼 클릭
5. **맞춤형 질문**: 하교 시간, 취침 시간, 우선순위 등 답변
6. **결과 확인**: AI가 생성한 최적 스케줄 확인 및 적용

## 🎨 UI/UX 흐름

### 1단계: Intro (소개)
```
📊 현재 시간표 분석 결과
┌─────────────┬─────────────┐
│ 전체 일정    │ 충돌 발생    │
│    60개     │    12건     │
└─────────────┴─────────────┘

⚠️ 시간이 겹치는 일정이 있습니다
• 영어 ↔ 구몬
• 댄스 ↔ 축구
...

[시작하기 →]
```

### 2단계: Questions (질문)
```
Progress: ████████░░░░░░░░ 50%

🕐 질문 3 / 6

학원 간 이동 시간은 평균 몇 분 정도인가요? *
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[    10    ] 분

💡 도보/차량 이동 시간을 고려해주세요

[← 이전]  [다음 →]
```

### 3단계: Processing
```
    ⟳
   ✨
  🤖

AI가 최적의 스케줄을 생성하고 있습니다...
잠시만 기다려주세요. GPT가 분석 중입니다.
```

### 4단계: Result (결과)
```
✅ 최적화 완료!
12건의 충돌이 해결되었습니다

💡 AI의 설명
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
화요일 영어를 제거하여 구몬과의 충돌을 해결했습니다.
수요일을 휴식일로 지정하여 과도한 학습을 방지했습니다...

┌────────┬────────┬────────┐
│ 총 수업 │ 주당   │ 일평균  │
│  45개  │ 18.5H  │  2.6H  │
└────────┴────────┴────────┘

[이 스케줄 적용하기 ✓]
```

## 🧠 AI 프롬프트 전략

### 1. 구조화된 입력
```
- 전체 스케줄 데이터 (JSON)
- 충돌 정보 (상세)
- 사용자 선호도 (우선순위 포함)
```

### 2. 명확한 제약 조건
```
- 취침 시간 이후 일정 불가
- 최소 이동 시간 확보
- 저녁 식사 시간 회피
- 숙제/복습 시간 필수
```

### 3. JSON 형식 강제
```
반드시 유효한 JSON으로만 응답하도록 지시
파싱 오류 시 fallback 로직
```

## 📊 알고리즘 상세

### 충돌 감지 알고리즘
```javascript
1. 모든 스케줄을 요일별로 그룹화
2. 각 요일 내에서 O(n²) 비교
3. 시간 겹침 체크: start1 < end2 && end1 > start2
4. 겹침 정도 계산: min(end1, end2) - max(start1, start2)
```

### 최적화 전략
```
1. 필터링:
   - 우선순위 없는 과목 제거
   - 취침 시간 이후 제거
   - 휴식 요일 제거

2. 충돌 해결:
   - 우선순위 높은 것 선택
   - 대체 시간/요일 제안
   - 시간 조정 옵션 제시

3. 균형 맞추기:
   - 학습/운동/예체능 비율
   - 요일별 부담도
   - 연속 수업 시간 제한
```

## 🔮 향후 개선 방향

### Phase 1 (현재)
- [x] 기본 충돌 감지
- [x] 맞춤형 질문 생성
- [x] Gemini AI 연동
- [x] 결과 시각화

### Phase 2 (예정)
- [ ] 드래그앤드롭으로 우선순위 조정
- [ ] 여러 대안 비교 UI
- [ ] 학원 연락처 자동 추가
- [ ] 캘린더 앱 연동 (Google Calendar 등)

### Phase 3 (장기)
- [ ] 학습 패턴 분석
- [ ] 성적/피로도 피드백
- [ ] 형제자매 스케줄 통합
- [ ] 학원 위치 기반 이동 시간 자동 계산

## 💡 팁

### 1. 질문 답변 요령
- 정확한 시간 입력 (예: 15:00, 22:00)
- 우선순위는 신중하게 (변경 어려움)
- 휴식 요일은 최소 1일 권장

### 2. AI 결과 해석
- explanation 필드를 꼭 읽기
- alternatives에서 다른 옵션 확인
- tips 참고하여 실생활 적용

### 3. 수동 조정
- AI 결과는 참고용
- 학원 변경 가능 여부 확인 필수
- 아이와 충분히 상의

## 🐛 트러블슈팅

### Q: AI 응답이 너무 오래 걸려요
A: 타임아웃이 180초로 설정되어 있습니다. 스케줄 개수를 줄이거나 규칙 기반 최적화를 사용하세요.

### Q: JSON 파싱 에러가 발생해요
A: AI 응답이 잘못된 형식일 수 있습니다. fallback으로 원본 스케줄이 반환됩니다.

### Q: 충돌이 제대로 감지되지 않아요
A: 시간 형식이 HH:MM 인지 확인하세요. 요일 코드가 올바른지도 체크하세요.

## 📞 지원

문제 발생 시:
1. 브라우저 콘솔 로그 확인
2. 서버 로그 확인
3. GitHub Issue 등록

---

Made with ❤️ by AI Schedule Team
