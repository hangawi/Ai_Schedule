# AI 일정 조율 시스템 - 프로젝트 현황 통합 문서

**최종 업데이트:** 2026-01-27
**시스템 상태:** 프로덕션 준비 완료

---

## 1. 프로젝트 개요

### 목표
그룹 채팅을 통해 자연스럽게 일정을 조율하고, AI가 합의된 일정을 자동으로 감지하여 제안하는 시스템

### 핵심 설계 철학: LLM 중심 (하드코딩 최소화)
- **날짜 계산**: LLM이 "금요일", "다음주 월요일" 등을 직접 계산
- **시간 해석**: LLM이 맥락으로 "6시 밥" → 18:00 판단
- **합의 감지**: LLM이 대화 흐름으로 자연스럽게 판단
- **프롬프트**: 한국어로 작성하여 문화적 맥락 전달 강화
- **Few-Shot Learning**: 10가지 실제 대화 예시 제공

---

## 2. 개발 완료 현황

### AI 엔진 (Phase 1-6) - 모두 완료
| Phase | 작업 | 상태 |
|-------|------|------|
| 1 | 프롬프트 분리 및 개선 (한국어, LLM 중심) | ✅ |
| 2 | 거절 추적 시스템 (중복 제안 방지) | ✅ |
| 3 | 거절 메시지 기록 (시스템 메시지) | ✅ |
| 4 | 선호시간 체크 로직 (충돌 감지) | ✅ |
| 5 | 최종 확인 플로우 (확인 모달) | ✅ |
| 6 | 날짜 인식 개선 및 테스트 케이스 | ✅ |

### 모바일 버전 (Phase 1-5) - 대부분 완료
| Phase | 작업 | 상태 |
|-------|------|------|
| 1 | 기본 구조 설정 (MobileDashboard) | ✅ |
| 2 | FullCalendar 통합 | ✅ |
| 3 | 화면 연결 (Router) | ✅ |
| 4 | UX 개선 및 버그 수정 | ✅ |
| 5 | 대화형 자동 일정 조율 시스템 | 테스트 중 |

---

## 3. 주요 파일 구조

### 서버
```
server/
├── prompts/
│   └── scheduleAnalysis.js      # AI 프롬프트 (한국어, Few-shot 10개)
├── models/
│   ├── ScheduleSuggestion.js    # 일정 제안 스키마
│   └── RejectedSuggestion.js    # 거절 내역 스키마
├── services/
│   ├── aiScheduleService.js     # AI 분석 서비스
│   └── preferenceService.js     # 선호시간 체크 서비스
├── controllers/
│   └── chatController.js        # 채팅/제안 API
└── routes/
    └── chat.js                  # API 라우트
```

### 클라이언트
```
client/src/components/chat/
├── GroupChat.js                 # 그룹 채팅 (AI 제안 카드)
└── SuggestionModal.js           # 일정 제안 모달 (미래/오늘/지난)
```

---

## 4. 전체 시스템 플로우

```
[사용자 채팅]
    ↓
[chatController.sendMessage]
    ↓ (비동기)
[aiScheduleService.analyzeConversation]
    ├─ 최근 20개 메시지 조회
    ├─ 한국어 프롬프트 생성
    ├─ Gemini API 호출
    ├─ JSON 파싱
    ├─ 형식 검증 + endTime 자동생성
    ├─ 과거 날짜 검증
    ├─ 거절 내역 체크
    ├─ ScheduleSuggestion DB 저장
    └─ Socket 'schedule-suggestion' 이벤트
            ↓
    [클라이언트 수신]
    [GroupChat: 제안 카드 표시]
            ↓
    [사용자가 [일정] 버튼 클릭]
            ↓
    [SuggestionModal 열림]
    ├─ 미래/오늘/지난 약속 조회
    └─ 사용자가 [참석] 클릭
            ↓
    [chatController.acceptSuggestion]
    ├─ user.personalTimes에 추가
    ├─ suggestion.acceptByUser()
    ├─ 시스템 메시지 생성
    └─ Socket 'suggestion-updated' 이벤트
            ↓
    [모든 클라이언트 실시간 업데이트]
```

---

## 5. 수정된 주요 버그

### AI 엔진 관련
1. **프롬프트 JSON 형식 오류** - 설명과 예시 분리로 해결
2. **endTime 누락** - startTime + 1시간 자동 생성 로직 추가
3. **today 변수 미정의** - `new Date()` 사용으로 수정
4. **"다음주 토요일" 오인식** - 프롬프트에 명확한 설명 추가 (Example 5)
5. **Room day enum 누락** - saturday, sunday 추가

### 채팅/소켓 관련
1. **채팅 실시간 표시 안 됨** - socket.on('connect') 안에서 join-room emit
2. **한글 파일명 인코딩** - FormData에 originalFileName 필드 추가

### 모바일 관련
1. **개인시간 표시 누락** - days, daysOfWeek 모두 체크
2. **색상 블록 표시** - SimplifiedScheduleDisplay 블록 UI로 변경
3. **헤더 누락** - 별도 헤더 컴포넌트 추가

---

## 6. 날짜 인식 테스트 케이스

### 필수 통과 테스트 (다음주 표현)
| 테스트 | 대화 | 기준일 | 기대 결과 |
|--------|------|--------|-----------|
| 2.1 | "다음주 월요일 오전 9시" | 2026-01-27 (화) | 2026-02-03 |
| 2.2 | "다음주 목요일 오후 4시" | 2026-01-27 (화) | 2026-02-05 |
| 2.3 | "다음주 토요일 오후 2시" | 2026-01-27 (화) | 2026-02-07 |
| 2.4 | "다음주 일요일 점심" | 2026-01-27 (화) | 2026-02-08 |

### 추가 테스트 카테고리
- 기본 상대 날짜 (내일, 모레)
- 이번주 표현 (이번주 금요일)
- 주말 경계 케이스 (금요일에 "다음주 월요일")
- 월말/월초 경계 케이스 (1월→2월, 12월→1월)
- 구체적 날짜 (2월 5일, 30일)
- 시간 표현 (오전/오후, 24시간, 반)
- 부정적 응답 (거절, 논의 중)

### 테스트 실행 방법
1. 서버/클라이언트 실행
2. 대화형 모드 방 생성
3. 테스트 케이스 대화 입력
4. AI 제안 결과 확인

---

## 7. API 엔드포인트

### 일정 제안 관련
```
GET  /api/chat/:roomId/suggestions?status=future|today|past
POST /api/chat/:roomId/suggestions/:suggestionId/accept
POST /api/chat/:roomId/suggestions/:suggestionId/reject
POST /api/chat/:roomId/check-conflict
```

### Socket 이벤트
```
schedule-suggestion    # 새 제안 발생
suggestion-updated     # 제안 상태 업데이트 (수락/거절)
schedule-rejected      # 거절 시
join-room              # 방 입장
```

---

## 8. 향후 개선 가능 항목

### 단기
- [ ] LLM 응답 품질 모니터링 (잘못된 날짜 계산 로그 수집)
- [ ] 프롬프트 A/B 테스팅
- [ ] 다양한 대화 패턴 수집 및 Few-shot 예시 추가

### 중장기
- [ ] 다국어 지원 (영어권 사용자용 프롬프트)
- [ ] 시간대(timezone) 지원
- [ ] 반복 일정 제안
- [ ] 선호 시간 힌트 제공 (선택적)

---

## 9. 모니터링 권장 항목

- LLM 응답 실패율 (JSON 파싱 오류)
- 날짜 계산 오류 (과거 날짜 경고 빈도)
- Socket 연결 끊김
- API 응답 시간

---

## 10. 기술 스택

- **백엔드**: Node.js, Express, MongoDB, Socket.io
- **프론트엔드**: React, FullCalendar
- **AI**: Google Gemini 2.0-flash
- **실시간 통신**: Socket.io

---

## 결론

**시스템 상태: 프로덕션 준비 완료**

- 모든 핵심 기능 구현 완료
- 하드코딩 최소화, LLM 자연어 이해 능력 최대 활용
- Few-shot learning으로 다양한 상황 커버
- 형식 검증 안전장치 유지
- 실시간 Socket 업데이트 완비

> **"LLM을 믿어라. 규칙을 주지 말고 예시를 줘라."**
