# ì¼ë°˜ ì‚¬ìš©ì â†’ êµ¬ê¸€ ê³„ì • ì—°ë™ ê¸°ëŠ¥

**ì‘ì„±ì¼:** 2026-02-09
**ìƒíƒœ:** ê³„íš ì¤‘

---

## ê°œìš”

ì¼ë°˜(ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸) ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ ì„¤ì • í˜ì´ì§€ì—ì„œ êµ¬ê¸€ ê³„ì •ì„ ì—°ë™í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
ì—°ë™ í›„ì—ëŠ” êµ¬ê¸€ ë¡œê·¸ì¸ìœ¼ë¡œë„ ì ‘ì† ê°€ëŠ¥í•˜ë©°, ê¸°ì¡´ ë°ì´í„°(ì¼ì •, ì„ í˜¸ì‹œê°„, ì¡°ìœ¨ë°© ë“±)ê°€ ê·¸ëŒ€ë¡œ ìœ ì§€ëœë‹¤.

---

## í•µì‹¬ ì›ë¦¬

ê¸°ì¡´ ë°ì´í„°ëŠ” MongoDBì˜ User ë¬¸ì„œì— ì €ì¥ë˜ì–´ ìˆê³ , UserëŠ” `firebaseUid`ë¡œ ì‹ë³„ëœë‹¤.
Firebase AuthëŠ” í•˜ë‚˜ì˜ ê³„ì •ì— ì—¬ëŸ¬ ë¡œê·¸ì¸ ë°©ë²•(ì´ë©”ì¼, êµ¬ê¸€ ë“±)ì„ **ë§í¬**í•  ìˆ˜ ìˆë‹¤.
ë”°ë¼ì„œ êµ¬ê¸€ Providerë¥¼ ê¸°ì¡´ Firebase ê³„ì •ì— ë§í¬í•˜ë©´ **firebaseUidê°€ ë³€í•˜ì§€ ì•Šì•„** ë°ì´í„° ì´ì „ì´ í•„ìš” ì—†ë‹¤.

```
[ê¸°ì¡´]
Firebase ê³„ì • (UID: abc123) â† ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸
  â†’ MongoDB User (firebaseUid: abc123) â† ëª¨ë“  ë°ì´í„° ì—¬ê¸°ì— ì €ì¥

[ì—°ë™ í›„]
Firebase ê³„ì • (UID: abc123) â† ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ OR êµ¬ê¸€ ë¡œê·¸ì¸ (ë‘˜ ë‹¤ ê°€ëŠ¥)
  â†’ MongoDB User (firebaseUid: abc123) â† ë°ì´í„° ê·¸ëŒ€ë¡œ ìœ ì§€
  â†’ + google.refreshToken ì¶”ê°€ â†’ êµ¬ê¸€ ìº˜ë¦°ë” ì—°ë™ ê°€ëŠ¥
```

---

## êµ¬í˜„ ë‹¨ê³„

### 1ë‹¨ê³„: ì„¤ì • í˜ì´ì§€ ìƒì„±

**ìƒˆ íŒŒì¼:** `client/src/components/mobile/MobileSettings.js`

- êµ¬ê¸€ ê³„ì • ì—°ë™ ë²„íŠ¼
- ì—°ë™ ìƒíƒœ í‘œì‹œ (ì—°ë™ë¨/ë¯¸ì—°ë™)
- ì—°ë™ í•´ì œ ë²„íŠ¼

### 2ë‹¨ê³„: ì‚¬ì´ë“œë°”ì— ì„¤ì • ë©”ë‰´ ì¶”ê°€

**ìˆ˜ì • íŒŒì¼:** ëª¨ë°”ì¼ ë·° 4ê³³ì˜ ì‚¬ì´ë“œë°”
- `client/src/components/mobile/MobileGroupsView.js`
- `client/src/components/mobile/MobileCalendarView.js`
- `client/src/components/mobile/MobileDashboard.js`
- `client/src/components/mobile/MobileScheduleView.js`

```
ê¸°ì¡´ ë©”ë‰´:
  ğŸ  í™ˆìœ¼ë¡œ
  ğŸ“… ë‚´ ì¼ì •
  ğŸ‘¥ ê·¸ë£¹
  ğŸ“† ë‹¬ë ¥

ì¶”ê°€:
  âš™ï¸ ì„¤ì •    â† ë§¨ ì•„ë˜ì— ì¶”ê°€
```

### 3ë‹¨ê³„: ë¼ìš°íŠ¸ ì¶”ê°€

**ìˆ˜ì • íŒŒì¼:** `client/src/App.js`

```
/mobile/settings â†’ MobileSettings ì»´í¬ë„ŒíŠ¸
```

### 4ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ - êµ¬ê¸€ ê³„ì • ë§í¬

**ìˆ˜ì • íŒŒì¼:** `client/src/components/mobile/MobileSettings.js`

```
[êµ¬ê¸€ ê³„ì • ì—°ë™í•˜ê¸°] ë²„íŠ¼ í´ë¦­
  â†’ Firebase linkWithPopup(googleProvider) í˜¸ì¶œ
  â†’ êµ¬ê¸€ ë¡œê·¸ì¸ íŒì—… í‘œì‹œ
  â†’ ì„±ê³µ ì‹œ: ì„œë²„ì— êµ¬ê¸€ í† í° ì €ì¥ ìš”ì²­
  â†’ ì‹¤íŒ¨ ì‹œ: ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
```

Firebaseì˜ `linkWithPopup` API:
- ê¸°ì¡´ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê³„ì •ì— êµ¬ê¸€ Providerë¥¼ ì¶”ê°€
- firebaseUid ë³€ê²½ ì—†ìŒ â†’ ë°ì´í„° ì•ˆì „

### 5ë‹¨ê³„: ë°±ì—”ë“œ - êµ¬ê¸€ í† í° ì €ì¥ API

**ìˆ˜ì • íŒŒì¼:** `server/routes/auth.js`, `server/controllers/authController.js`

```
POST /api/auth/link-google
  â†’ ìš”ì²­: { googleAccessToken, googleIdToken }
  â†’ ì„œë²„: Google OAuthë¡œ refreshToken íšë“
  â†’ MongoDB: user.google = { id, accessToken, refreshToken } ì €ì¥
  â†’ ì‘ë‹µ: { success: true, message: 'êµ¬ê¸€ ê³„ì • ì—°ë™ ì™„ë£Œ' }
```

### 6ë‹¨ê³„: êµ¬ê¸€ ìº˜ë¦°ë” ë™ê¸°í™” (ìë™)

ì—°ë™ ì™„ë£Œ í›„:
- `user.google.refreshToken`ì´ ì¡´ì¬ â†’ êµ¬ê¸€ ìº˜ë¦°ë” ì´ë²¤íŠ¸ê°€ ë‹¬ë ¥ì— ì´ˆë¡ìƒ‰ìœ¼ë¡œ í‘œì‹œ
- ê¸°ì¡´ ì½”ë“œê°€ ì´ë¯¸ ì´ ë™ì‘ì„ ì§€ì›í•¨ (refreshToken ìœ ë¬´ë¡œ íŒë‹¨)

---

## ìˆ˜ì • íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ì‘ì—… |
|------|------|
| `client/src/components/mobile/MobileSettings.js` | **ì‹ ê·œ** - ì„¤ì • í˜ì´ì§€ |
| `client/src/App.js` | ë¼ìš°íŠ¸ ì¶”ê°€ `/mobile/settings` |
| `client/src/components/mobile/MobileGroupsView.js` | ì‚¬ì´ë“œë°”ì— ì„¤ì • ë©”ë‰´ ì¶”ê°€ |
| `client/src/components/mobile/MobileCalendarView.js` | ì‚¬ì´ë“œë°”ì— ì„¤ì • ë©”ë‰´ ì¶”ê°€ |
| `client/src/components/mobile/MobileDashboard.js` | ì‚¬ì´ë“œë°”ì— ì„¤ì • ë©”ë‰´ ì¶”ê°€ |
| `client/src/components/mobile/MobileScheduleView.js` | ì‚¬ì´ë“œë°”ì— ì„¤ì • ë©”ë‰´ ì¶”ê°€ |
| `server/controllers/authController.js` | êµ¬ê¸€ ë§í¬ API ì¶”ê°€ |
| `server/routes/auth.js` | ë¼ìš°íŠ¸ ì¶”ê°€ |

---

## ë°ì´í„° íë¦„

```
[ì„¤ì • í˜ì´ì§€]
  ì‚¬ìš©ìê°€ "êµ¬ê¸€ ê³„ì • ì—°ë™í•˜ê¸°" í´ë¦­
       â†“
[Firebase Client SDK]
  linkWithPopup(auth.currentUser, googleProvider)
  â†’ êµ¬ê¸€ ë¡œê·¸ì¸ íŒì—… â†’ ì‚¬ìš©ì ìŠ¹ì¸
       â†“
[í”„ë¡ íŠ¸ì—”ë“œ]
  êµ¬ê¸€ credential íšë“ (accessToken, idToken)
  â†’ POST /api/auth/link-google { tokens }
       â†“
[ë°±ì—”ë“œ]
  Google OAuthë¡œ refreshToken êµí™˜
  â†’ user.google = { id, accessToken, refreshToken } ì €ì¥
  â†’ localStorageì— loginMethod = 'google' ì„¤ì •ì„ ìœ„í•œ ì‘ë‹µ
       â†“
[ì™„ë£Œ]
  - êµ¬ê¸€ ë¡œê·¸ì¸ ê°€ëŠ¥
  - êµ¬ê¸€ ìº˜ë¦°ë” ì´ˆë¡ìƒ‰ í‘œì‹œ
  - ê¸°ì¡´ ë°ì´í„° 100% ìœ ì§€
```

---

## ì£¼ì˜ì‚¬í•­

1. **ì´ë¯¸ êµ¬ê¸€ë¡œ ê°€ì…í•œ ë‹¤ë¥¸ ê³„ì •ì´ ìˆëŠ” ê²½ìš°**: Firebaseì—ì„œ `auth/credential-already-in-use` ì—ëŸ¬ ë°œìƒ â†’ "ì´ë¯¸ ë‹¤ë¥¸ ê³„ì •ì— ì—°ê²°ëœ êµ¬ê¸€ ê³„ì •ì…ë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ
2. **ì—°ë™ í•´ì œ**: Firebaseì—ì„œ `unlink('google.com')` + MongoDBì—ì„œ `user.google = null` ì²˜ë¦¬
3. **ë¡œê·¸ì¸ ì¸ë””ì¼€ì´í„°**: ì—°ë™ í›„ ë¡œê³  ìš°ì¸¡ ìƒë‹¨ ì›ì´ ì´ˆë¡ìƒ‰(êµ¬ê¸€)ìœ¼ë¡œ ë³€ê²½ë¨
