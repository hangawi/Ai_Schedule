# 작업 계획 (2026-02-10)

## 1. AI 채팅 "중복 일정으로 스킵" 오류 수정

### 문제
- AI가 일정 분석 시 실제로 중복이 아닌 일정도 "중복 일정으로 스킵"으로 처리
- `server/services/aiScheduleService.js` (162-183줄) `handleNewSchedule()`에서 발생

### 원인
- 중복 판단 조건이 너무 느슨함: **같은 날짜 + 시간 차이 2시간 이내**면 무조건 중복 처리
- 제목(summary)을 비교하지 않아서 완전히 다른 일정도 시간만 비슷하면 스킵됨
- 예: "점심 약속 12:00"과 "스터디 모임 13:00"이 중복으로 처리됨

### 수정 방안
- 중복 판단 조건에 **제목(summary) 유사도** 비교 추가
- 시간 차이 조건을 **같은 시작시간**으로 엄격하게 변경
- 즉, 같은 날짜 + 같은 시작시간 + 같은 제목일 때만 중복 처리

### 수정 파일
- `server/services/aiScheduleService.js`

---

## 2. 일정 소유권 이전 (제안자 탈퇴 시)

### 문제
- A가 일정을 만들고 B, C가 참여 → A가 불참(거절)
- 현재: 삭제 권한이 A에게만 있어서 아무도 삭제 못함
- 원하는 동작: A가 나가면 남은 참여자(B, C) 모두에게 삭제 권한 부여

### 수정 방안

#### 백엔드 (`chatController.js`)
1. `rejectSuggestion`: 제안자(suggestedBy)가 불참할 때 → suggestedBy를 null로 설정
2. `deleteSuggestion`: 권한 체크 수정
   - suggestedBy가 현재 사용자면 → 삭제 허용 (기존)
   - suggestedBy가 null이면 → accepted 상태인 멤버 누구나 삭제 가능 (신규)

#### 프론트엔드 (`SuggestionModal.js`)
1. `isOwner` 함수 수정: suggestedBy가 null일 때 → 현재 사용자가 accepted 멤버면 true 반환
2. 삭제 버튼이 B, C 모두에게 표시되도록

### 수정 파일
- `server/controllers/chatController.js` (deleteSuggestion, rejectSuggestion)
- `client/src/components/chat/SuggestionModal.js` (isOwner, 삭제 버튼)

---

## 3. 캘린더 색상 범례 추가

### 문제
- 앱 일정(빨간색)과 구글 캘린더 일정(파란색)의 구분을 사용자가 모름

### 현재 색상 체계
| 유형 | 배경색 | 설명 |
|------|--------|------|
| 앱 일정 | #ef4444 (빨강) | personalTimes (isGoogleEvent=false) |
| 구글 캘린더 | #3b82f6 (파랑) | personalTimes (isGoogleEvent=true) 또는 googleCalendarEvents |
| 선호시간 | #60a5fa (밝은파랑) | defaultSchedule |

### 수정 방안
- 캘린더 뷰 상단(뷰 선택 버튼 아래)에 간단한 범례 표시
- 작은 원(dot) + 텍스트로 "앱 일정" / "구글 캘린더" 표시
- 구글 연동 사용자에게만 범례 표시 (비연동 사용자는 빨간색만 있으므로 불필요)

### 수정 파일
- `client/src/components/mobile/MobileCalendarView.js` (범례 UI 추가)
- `client/src/components/mobile/MobileCalendarView.css` (범례 스타일)
