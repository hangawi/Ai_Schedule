# Ai_Mobile 리팩토링 가이드 - 대형 파일 분할

> **핵심 원칙: 절대 내용 삭제/누락 금지. 기존 코드를 파일 단위로 분리하고 import/export로 연결만 한다.**
>
> **대상 프로젝트**: `C:\Users\예상\OneDrive\Desktop\프로젝트\Ai_Mobile`

---

## 우선순위 요약

| 순위 | 파일 | 줄 수 | 난이도 | 분할 방식 |
|:---:|---|---:|:---:|---|
| P1 | `DetailTimeGrid/index.js` | 2,160 | 중 | 렌더 함수 → 하위 컴포넌트 |
| P2 | `MobileCalendarView.js` | 1,540 | 중 | 핸들러/훅/렌더 분리 |
| P3 | `travelScheduleCalculator.js` | 1,999 | 중 | 클래스 메서드 → 모듈별 분리 |
| P4 | `coordinationSchedulingController.js` | 1,743 | 중 | 헬퍼/검증/핵심로직 분리 |
| P5 | `scheduleAnalysis.js` (프롬프트) | 2,077 | 쉬움 | 프롬프트 섹션별 분리 |
| P6 | `scheduleOptimizer.js` (프롬프트) | 1,729 | 쉬움 | 프롬프트 섹션별 분리 |
| P7 | `coordinationExchangeController.js` | 1,700 | 중 | 서비스별 분리 |
| P8 | `WeekView.js` | 1,318 | 중 | 렌더 함수 → 하위 컴포넌트 |
| P9 | `TimetableGrid.js` | 1,311 | 중 | 렌더/핸들러 분리 |
| P10 | `aiScheduleService.js` | 1,324 | 중 | 기능별 분리 |
| P11 | `chatController.js` | 1,136 | 중 | CRUD/AI/알림 분리 |
| P12 | `calendarController.js` | 1,014 | 중 | Google/로컬/동기화 분리 |
| P13 | `scheduleAutoOptimizer.js` | 932 | 쉬움 | 헬퍼 함수 분리 |
| P14 | `confirmScheduleService.js` | 821 | 쉬움 | Google/로컬/헬퍼 분리 |
| P15 | `utils.js` (클라이언트) | 785 | 쉬움 | 카테고리별 분리 |
| P16 | `eventController.js` | 731 | 쉬움 | CRUD/충돌/추천 분리 |
| P17 | `DateDetailModal.js` | 750 | 중 | 하위 컴포넌트 분리 |
| P18 | `GroupChat.js` | 745 | 중 | 하위 컴포넌트 분리 |
| P19 | `SuggestionModal.js` | 714 | 중 | 하위 컴포넌트 분리 |
| P20 | `MobileScheduleView.js` | 696 | 중 | 핸들러/렌더 분리 |

---

## P1. DetailTimeGrid/index.js (2,160줄)

**위치**: `client/src/components/calendar/DetailTimeGrid/index.js`

**현재 구조**: 단일 컴포넌트에 상세뷰, 병합뷰, 복사 옵션, 직접 입력, 삭제 등 모든 로직 포함

**분할 계획**:
```
DetailTimeGrid/
  index.js              ← 메인 (import만 남기고 조합)
  constants.js          ← priorityConfig, copyOptions 등 상수
  hooks/
    useDetailTimeGrid.js ← 상태 관리 + 핸들러 (useState, useCallback 등)
  components/
    DetailedView.js     ← renderDetailedView 함수 → 독립 컴포넌트
    MergedView.js       ← renderMergedView 함수 → 독립 컴포넌트
    CopyOptionsPanel.js ← 복사 옵션 UI
    DirectInputPanel.js ← 직접 입력 UI
    TimeSlotItem.js     ← 개별 시간 슬롯 렌더링
  utils/
    timeSlotMerger.js   ← (이미 존재) 유지
    dateFormatters.js   ← (이미 존재) 유지
    slotHelpers.js      ← (이미 존재) 유지
```

### TODO
- [x] `constants.js` 생성: priorityConfig, copyType 상수 추출
- [x] `hooks/useDetailTimeGrid.js` 생성: 모든 useState, useCallback, useEffect 추출
- [x] `components/DetailedView.js` 생성: renderDetailedView 함수 이동
- [x] `components/MergedView.js` 생성: renderMergedView 함수 이동
- [x] `components/CopyOptionsPanel.js` 생성: 복사 옵션 관련 JSX 이동
- [x] `components/DirectInputPanel.js` 생성: 직접 입력 UI
- [x] `components/TimeSlotItem.js` 생성: 개별 슬롯 렌더링 JSX 이동 (DetailedView에 적용)
- [x] `index.js` 수정: 분리된 모듈 import하여 조합
- [ ] 빌드 테스트 통과 확인

---

## P2. MobileCalendarView.js (1,540줄)

**위치**: `client/src/components/mobile/MobileCalendarView.js`

**현재 구조**: FullCalendar + 채팅 + 음성인식 + 카메라OCR + 이벤트CRUD + 터치 제스처 + 사이드바 전부 단일 파일

**분할 계획**:
```
mobile/
  MobileCalendarView.js       ← 메인 (import 조합만)
  MobileCalendarView.css      ← (유지)
  calendarView/
    hooks/
      useCalendarData.js      ← fetchSchedule, 이벤트 데이터 로딩/상태
      useCalendarHandlers.js  ← handleDateClick, handleEventClick, handleDeleteScheduleEvent 등
      useTouchGesture.js      ← handleTouchStart, handleTouchMove, handleTouchEnd, translateY
      useCameraOCR.js         ← handleStartCamera, handleCameraCapture, cameraInputRef
      useVoiceRecognition.js  ← handleStartVoiceRecognition 관련
    components/
      CalendarHeader.js       ← 사이드바 + 헤더 + 프로필 버튼
      CalendarContent.js      ← FullCalendar 렌더링 + renderEventContent
      BottomSection.js        ← renderBottomSection (채팅, 일정 목록)
      EventEditPanel.js       ← 일정 수정 모드 UI (isEditing 상태)
      ConfirmModal.js         ← confirmModal 상태 관련 모달
    utils/
      eventColorUtils.js      ← 이벤트 색상 결정 로직 (color, containerClass)
      eventDataUtils.js       ← getEventsForDate, dayEvents 계산
```

### TODO
- [x] `calendarView/hooks/useCalendarData.js` 생성: fetchSchedule, isLoading, events 상태
- [x] `calendarView/hooks/useCalendarHandlers.js` 생성: 이벤트 핸들러 전체
- [x] `calendarView/hooks/useTouchGesture.js` 생성: 터치 관련 로직 전체
- [x] `calendarView/hooks/useCameraOCR.js` 생성: 카메라/OCR 관련
- [x] `calendarView/hooks/useVoiceRecognition.js` 생성: 음성인식 관련
- [x] `calendarView/components/CalendarHeader.js` 생성: 사이드바+헤더 JSX
- [x] `calendarView/components/CalendarContent.js` 생성: FullCalendar JSX
- [x] `calendarView/components/BottomSection.js` 생성: 하단 섹션 JSX
- [x] `calendarView/components/EventEditPanel.js` 생성: 수정 모드 JSX
- [x] `calendarView/utils/eventColorUtils.js` 생성: 색상 로직
- [x] `calendarView/utils/eventDataUtils.js` 생성: 이벤트 데이터 처리
- [x] `MobileCalendarView.js` 수정: 분리된 모듈 import하여 조합
- [ ] 빌드 테스트 통과 확인

---

## P3. travelScheduleCalculator.js (1,999줄)

**위치**: `client/src/services/travelScheduleCalculator.js`

**현재 구조**: `TravelScheduleCalculator` 클래스 1개에 18개 메서드가 전부 들어있음

**주요 메서드**:
- 유틸리티: `formatTime`, `parseTime`, `toLocalDateString`, `unmergeBlock`
- 검증: `validateWalkingMode` (127~216)
- 멤버 처리: `buildMemberPreferences` (224~319), `mergeOverlappingSlots` (327~348), `isWithinPreferredTime` (361~397)
- 충돌 검사: `checkOverlap` (408~419), `checkBlockedTimeConflict` (429~441)
- 슬롯 배치: `findAvailableSlot` (456~557), `findAvailableSlotsWithSplit` (572~724)
- 시뮬레이션: `simulateTimeSlotPlacement` (737~915)
- 멤버 시간 조회: `getBlockedTimesForMember` (926~965), `getAvailableTimesForMember` (977~1026)
- 정렬: `sortSlotsByDistance` (1036~1142)
- 거리 계산: `calculateDistance` (1153~1163)
- 핵심: `recalculateScheduleWithTravel` (1173~1995) ← **822줄, 가장 큰 메서드**

**분할 계획**:
```
services/travelSchedule/
  index.js                    ← TravelScheduleCalculator 클래스 (import 조합)
  timeUtils.js                ← formatTime, parseTime, toLocalDateString, unmergeBlock
  validationUtils.js          ← validateWalkingMode
  memberUtils.js              ← buildMemberPreferences, mergeOverlappingSlots, isWithinPreferredTime
  conflictUtils.js            ← checkOverlap, checkBlockedTimeConflict
  slotPlacement.js            ← findAvailableSlot, findAvailableSlotsWithSplit
  simulation.js               ← simulateTimeSlotPlacement
  memberTimeQuery.js          ← getBlockedTimesForMember, getAvailableTimesForMember
  distanceSorting.js          ← sortSlotsByDistance, calculateDistance
  recalculateSchedule.js      ← recalculateScheduleWithTravel (핵심 메서드, 내부도 단계별 분리)
```

### TODO
- [x] `services/travelSchedule/` 디렉토리 생성
- [x] `timeUtils.js` 생성: formatTime, parseTime, toLocalDateString, unmergeBlock 이동
- [x] `validationUtils.js` 생성: validateWalkingMode 이동
- [x] `memberUtils.js` 생성: buildMemberPreferences, mergeOverlappingSlots, isWithinPreferredTime 이동
- [x] `conflictUtils.js` 생성: checkOverlap, checkBlockedTimeConflict 이동
- [x] `slotPlacement.js` 생성: findAvailableSlot, findAvailableSlotsWithSplit 이동
- [x] `simulation.js` 생성: simulateTimeSlotPlacement 이동
- [x] `memberTimeQuery.js` 생성: getBlockedTimesForMember, getAvailableTimesForMember 이동 (simulationUtils.js에 포함됨)
- [x] `distanceSorting.js` 생성: sortSlotsByDistance, calculateDistance 이동
- [x] `recalculateSchedule.js` 생성: recalculateScheduleWithTravel 이동
- [x] `index.js` 생성: 분리된 유틸을 import하여 클래스에 바인딩, default export 유지
- [ ] 빌드 테스트 통과 확인

---

## P4. coordinationSchedulingController.js (1,743줄)

**위치**: `server/controllers/coordinationSchedulingController.js`

**현재 구조**: 상수/검증/헬퍼/핵심 API 함수가 모두 한 파일

**주요 export**:
- 상수: HTTP_STATUS, ERROR_MESSAGES, DEFAULTS, SLOT_TYPES, VALID_ASSIGNMENT_MODES, VALIDATION_RULES
- 검증: validateRoomExists, validateOwnerPermission, validateOwnerSchedule, validateMembersSchedule, validateMinHoursPerWeek, validateAutoConfirmDuration
- 헬퍼: getRoomById, getRoomWithMembers, getMemberIds, getMembersOnly, filterAutoAssignedSlots, filterNonTravelSlots, shouldPreserveSlot, removeAutoAssignedSlots, updateRoomSettings
- 타이머: setConfirmationTimer, isConfirmationTimerRunning, cancelConfirmationTimer, startConfirmationTimer, isScheduleConfirmed
- 핵심 API: runAutoSchedule, runAutoScheduling, applySchedulingResult, getAvailableSlots, deleteAllTimeSlots, confirmSchedule, setAutoConfirmDuration
- 이동모드: applyTravelMode, applyTravelModeToRoom, confirmTravelMode, confirmTravelModeForRoom, validateScheduleWithTransportMode
- 이월: checkLongTermCarryOvers, getExistingCarryOvers, confirmSlotsToPersonalCalendar, clearTravelModeData

**분할 계획**:
```
controllers/coordinationScheduling/
  index.js                ← 라우터 핸들러 (API 엔드포인트 함수만)
  constants.js            ← HTTP_STATUS, ERROR_MESSAGES, DEFAULTS, SLOT_TYPES, VALID_ASSIGNMENT_MODES, VALIDATION_RULES
  validators.js           ← validateRoomExists, validateOwnerPermission 등 6개 검증 함수
  helpers.js              ← getRoomById, getRoomWithMembers, getMemberIds 등 9개 헬퍼
  timerService.js         ← setConfirmationTimer, isConfirmationTimerRunning 등 타이머 4개
  schedulingService.js    ← runAutoScheduling, applySchedulingResult 등 핵심 스케줄링
  travelModeService.js    ← applyTravelMode, confirmTravelMode 등 이동모드 5개
  carryOverService.js     ← checkLongTermCarryOvers, getExistingCarryOvers 등 이월 4개
```

### TODO
- [x] `controllers/coordinationScheduling/` 디렉토리 생성
- [x] `constants.js` 생성: 6개 상수 객체 이동
- [x] `validators.js` 생성: 6개 검증 함수 이동
- [x] `helpers.js` 생성: 9개 헬퍼 함수 이동
- [x] `timerService.js` 생성: 타이머 관련 4개 함수 이동
- [x] `schedulingService.js` 생성: 핵심 스케줄링 함수 이동
- [x] `travelModeService.js` 생성: 이동모드 5개 함수 이동
- [x] `carryOverService.js` 생성: 이월 관련 4개 함수 이동
- [x] `coordinationSchedulingController.js`에서 `exports.applyTravelMode` 제거
- [x] `coordinationSchedulingController.js`에서 `exports.confirmTravelMode` 제거 (정의 자체가 없어 제거 작업 불필요 확인)
- [x] `coordinationSchedulingController.js`에서 `exports.validateScheduleWithTransportMode` 제거 (정의 자체가 없어 제거 작업 불필요 확인)
- [x] `coordinationSchedulingController.js`에서 `exports.deleteAllTimeSlots` 함수의 지역 `saveWithRetry` 함수 제거 및 `scheduleConfirmService`의 `saveUserWithRetry` 함수로 대체
- [ ] `index.js` 생성: 분리된 모듈 import, module.exports로 API 함수 내보내기
- [ ] `coordinationSchedulingController.js`에서 `exports.confirmSchedule` 함수 제거 및 `scheduleConfirmService.js`로 통합
- [ ] 서버 시작 테스트 확인

---

## P5. scheduleAnalysis.js (2,077줄)

**위치**: `server/prompts/scheduleAnalysis.js`

**현재 구조**: `generateSchedulePrompt` 함수 1개에 거대한 프롬프트 템플릿

**분할 계획**:
```
prompts/scheduleAnalysis/
  index.js                ← generateSchedulePrompt (조합만)
  systemPrompt.js         ← 시스템 프롬프트 텍스트
  userDataTemplate.js     ← 사용자 데이터 포맷 템플릿
  responseFormat.js       ← AI 응답 형식 정의
  examplePrompts.js       ← 예시/few-shot 프롬프트
  rules.js                ← 규칙/제약조건 텍스트
```

### TODO
- [ ] `prompts/scheduleAnalysis/` 디렉토리 생성
- [ ] 프롬프트 내용을 논리적 섹션별로 분리 (위 구조 참고)
- [ ] `index.js`에서 조합하여 동일한 generateSchedulePrompt 함수 export
- [ ] 서버 시작 테스트 확인

---

## P6. scheduleOptimizer.js (1,729줄)

**위치**: `server/prompts/scheduleOptimizer.js`

**현재 구조**: `generatePrompt` 함수 + `CONFIRMATION_RULES` 상수

**분할 계획**:
```
prompts/scheduleOptimizer/
  index.js                ← generatePrompt, CONFIRMATION_RULES (조합)
  systemPrompt.js         ← 시스템 프롬프트 텍스트
  optimizationRules.js    ← 최적화 규칙 텍스트
  confirmationRules.js    ← CONFIRMATION_RULES 상수
  responseFormat.js       ← AI 응답 형식 정의
  dataTemplate.js         ← 데이터 포맷 템플릿
```

### TODO
- [ ] `prompts/scheduleOptimizer/` 디렉토리 생성
- [ ] 프롬프트 내용을 논리적 섹션별로 분리
- [ ] `index.js`에서 조합하여 동일한 export 유지
- [ ] 서버 시작 테스트 확인

---

## P7. coordinationExchangeController.js (1,700줄)

**위치**: `server/controllers/coordinationExchangeController.js` (또는 디렉토리)

**현재 구조**: 일정 교환/변경 요청 관련 컨트롤러

**분할 계획**:
```
controllers/coordinationExchange/
  index.js                ← API 핸들러 (라우터 연결용)
  constants.js            ← 상수 및 에러 메시지
  validators.js           ← 요청 유효성 검증
  exchangeService.js      ← 교환 요청 처리 핵심 로직
  dateChangeService.js    ← (이미 존재하면 유지) 날짜 변경 서비스
  helpers.js              ← 공통 헬퍼 함수
```

### TODO
- [ ] 기존 구조 확인 (이미 디렉토리인 경우 하위 파일만 정리)
- [ ] 상수/검증/서비스/헬퍼 분리
- [ ] `index.js`에서 module.exports 유지
- [ ] 서버 시작 테스트 확인

---

## P8. WeekView.js (1,318줄)

**위치**: `client/src/components/timetable/WeekView.js`

**현재 구조**: 주간 시간표 렌더링 컴포넌트, renderNormalView 등 렌더 함수 포함

**주요 심볼**: dayNamesKorean, minutesToTime, timeToMinutes, slotHeight, renderNormalView, WeekView

**분할 계획**:
```
timetable/
  WeekView.js             ← 메인 (import 조합)
  weekView/
    constants.js          ← dayNamesKorean, slotHeight 등 상수
    utils.js              ← minutesToTime, timeToMinutes 등 유틸
    components/
      NormalView.js       ← renderNormalView → 독립 컴포넌트
      TimeSlotBlock.js    ← 개별 시간 블록 렌더링
      DayColumn.js        ← 요일별 컬럼 렌더링
      TravelSlotBlock.js  ← 이동시간 블록 렌더링 (modeIcon 등)
```

### TODO
- [ ] `weekView/constants.js` 생성: 상수 이동
- [ ] `weekView/utils.js` 생성: 시간 변환 유틸 이동
- [ ] `weekView/components/NormalView.js` 생성: renderNormalView JSX 이동
- [ ] `weekView/components/TimeSlotBlock.js` 생성: 블록 렌더링 JSX 이동
- [ ] `weekView/components/DayColumn.js` 생성: 요일 컬럼 JSX 이동
- [ ] `weekView/components/TravelSlotBlock.js` 생성: 이동시간 블록 이동
- [ ] `WeekView.js` 수정: import 조합
- [ ] 빌드 테스트 통과 확인

---

## P9. TimetableGrid.js (1,311줄)

**위치**: `client/src/components/timetable/TimetableGrid.js`

**현재 구조**: 시간표 그리드 + 슬롯 변경/요청 모달 + 확인 모달 전부 포함

**분할 계획**:
```
timetable/
  TimetableGrid.js        ← 메인 (import 조합)
  timetableGrid/
    hooks/
      useTimetableGrid.js ← 상태 관리 (days, roomData, slotToChange, confirmModal 등)
      useSlotHandlers.js  ← 슬롯 클릭/변경/요청 핸들러
    components/
      GridHeader.js       ← 그리드 헤더 (요일 표시)
      GridBody.js         ← 그리드 본체 (시간 슬롯 배열)
      SlotChangeModal.js  ← slotToChange 관련 모달
      ConfirmModal.js     ← confirmModal 관련 모달
```

### TODO
- [ ] `timetableGrid/hooks/useTimetableGrid.js` 생성: 상태 로직 추출
- [ ] `timetableGrid/hooks/useSlotHandlers.js` 생성: 핸들러 추출
- [ ] `timetableGrid/components/GridHeader.js` 생성
- [ ] `timetableGrid/components/GridBody.js` 생성
- [ ] `timetableGrid/components/SlotChangeModal.js` 생성
- [ ] `timetableGrid/components/ConfirmModal.js` 생성
- [ ] `TimetableGrid.js` 수정: import 조합
- [ ] 빌드 테스트 통과 확인

---

## P10. aiScheduleService.js (1,324줄)

**위치**: `server/services/aiScheduleService.js`

**현재 구조**: AI 일정 분석/생성/취소/연장/자동응답 모든 기능

**주요 함수**: analyzeConversation, handleNewSchedule, handleCancelSchedule, handleExtendSchedule, handleAutoResponse, sendSystemMessage, validateDateTimeFormat, calculateEndTime, _doAnalysis

**분할 계획**:
```
services/aiSchedule/
  index.js                ← analyzeConversation (메인 진입점) + re-export
  analysis.js             ← _doAnalysis, analyzeConversation 핵심 분석 로직
  newScheduleHandler.js   ← handleNewSchedule
  cancelHandler.js        ← handleCancelSchedule
  extendHandler.js        ← handleExtendSchedule
  autoResponseHandler.js  ← handleAutoResponse
  messageService.js       ← sendSystemMessage
  dateTimeUtils.js        ← validateDateTimeFormat, calculateEndTime
```

### TODO
- [ ] `services/aiSchedule/` 디렉토리 생성
- [ ] `dateTimeUtils.js` 생성: validateDateTimeFormat, calculateEndTime 이동
- [ ] `messageService.js` 생성: sendSystemMessage 이동
- [ ] `analysis.js` 생성: _doAnalysis, analyzeConversation 이동
- [ ] `newScheduleHandler.js` 생성: handleNewSchedule 이동
- [ ] `cancelHandler.js` 생성: handleCancelSchedule 이동
- [ ] `extendHandler.js` 생성: handleExtendSchedule 이동
- [ ] `autoResponseHandler.js` 생성: handleAutoResponse 이동
- [ ] `index.js` 생성: 모든 함수 re-export (기존 require 경로 호환)
- [ ] 서버 시작 테스트 확인

---

## P11. chatController.js (1,136줄)

**위치**: `server/controllers/chatController.js`

**주요 함수**: getMessages, sendMessage, acceptSuggestion, rejectSuggestion, forceAcceptSuggestion, deleteSuggestion, getSuggestions, confirmSchedule, rejectSchedule, notifyMemberDecline, deleteMessage, markAsRead, correctTypo, checkScheduleConflict

**분할 계획**:
```
controllers/chat/
  index.js               ← module.exports (API 핸들러 조합)
  messageHandlers.js     ← getMessages, sendMessage, deleteMessage, markAsRead, correctTypo
  suggestionHandlers.js  ← acceptSuggestion, rejectSuggestion, forceAcceptSuggestion, deleteSuggestion, getSuggestions
  scheduleHandlers.js    ← confirmSchedule, rejectSchedule, checkScheduleConflict
  notificationHandlers.js ← notifyMemberDecline
```

### TODO
- [ ] `controllers/chat/` 디렉토리 생성
- [ ] `messageHandlers.js` 생성: 메시지 CRUD 5개 함수 이동
- [ ] `suggestionHandlers.js` 생성: 제안 관련 5개 함수 이동
- [ ] `scheduleHandlers.js` 생성: 일정 확인/거절/충돌 3개 함수 이동
- [ ] `notificationHandlers.js` 생성: 알림 1개 함수 이동
- [ ] `index.js` 생성: module.exports 조합
- [ ] `server/routes/chat.js`의 require 경로 업데이트
- [ ] 서버 시작 테스트 확인

---

## P12. calendarController.js (1,014줄)

**위치**: `server/controllers/calendarController.js`

**주요 함수**: getCalendarEvents, createGoogleCalendarEvent, updateGoogleCalendarEvent, deleteGoogleCalendarEvent, syncEventsToGoogle, syncFromGoogle, analyzeImage

**분할 계획**:
```
controllers/calendar/
  index.js                ← module.exports 조합
  localCalendar.js        ← getCalendarEvents (로컬 이벤트 조회)
  googleCalendar.js       ← createGoogleCalendarEvent, updateGoogleCalendarEvent, deleteGoogleCalendarEvent
  syncService.js          ← syncEventsToGoogle, syncEventsToGoogleInternal, syncFromGoogle, updateAccessToken
  imageAnalysis.js        ← analyzeImage (Gemini AI 이미지 분석)
```

### TODO
- [ ] `controllers/calendar/` 디렉토리 생성
- [ ] `localCalendar.js` 생성
- [ ] `googleCalendar.js` 생성
- [ ] `syncService.js` 생성
- [ ] `imageAnalysis.js` 생성
- [ ] `index.js` 생성: module.exports 조합
- [ ] `server/routes/calendar.js`의 require 경로 업데이트
- [ ] 서버 시작 테스트 확인

---

## P13. scheduleAutoOptimizer.js (932줄)

**위치**: `server/utils/scheduleAutoOptimizer.js`

**주요 함수**: optimizeSchedules, categorizeSchedulesBatch, detectStudentGrade, filterSchedulesByGrade, hasTimeOverlap, imageHasOverlap

**분할 계획**:
```
utils/scheduleAutoOptimizer/
  index.js                ← optimizeSchedules (메인) re-export
  optimizer.js            ← optimizeSchedules 핵심 로직
  categorizer.js          ← categorizeSchedulesBatch
  gradeDetector.js        ← detectStudentGrade, filterSchedulesByGrade
  overlapUtils.js         ← hasTimeOverlap, imageHasOverlap
```

### TODO
- [ ] `utils/scheduleAutoOptimizer/` 디렉토리 생성
- [ ] `overlapUtils.js` 생성
- [ ] `gradeDetector.js` 생성
- [ ] `categorizer.js` 생성
- [ ] `optimizer.js` 생성
- [ ] `index.js` 생성: re-export
- [ ] 서버 시작 테스트 확인

---

## P14. confirmScheduleService.js (821줄)

**위치**: `server/services/confirmScheduleService.js`

**주요 함수**: confirmScheduleLogic, mergeConsecutiveSlots, removePreferenceTimes, saveUserWithRetry, getDayOfWeekNumber, minutesToTime, timeToMinutes, syncToGoogleCalendar, deleteFromGoogleCalendar

**분할 계획**:
```
services/confirmSchedule/
  index.js                ← confirmScheduleLogic re-export
  confirmLogic.js         ← confirmScheduleLogic 핵심 로직
  slotUtils.js            ← mergeConsecutiveSlots, removePreferenceTimes
  timeUtils.js            ← getDayOfWeekNumber, minutesToTime, timeToMinutes
  googleSync.js           ← syncToGoogleCalendar, deleteFromGoogleCalendar
  dbUtils.js              ← saveUserWithRetry
```

### TODO
- [ ] `services/confirmSchedule/` 디렉토리 생성
- [ ] `timeUtils.js` 생성
- [ ] `slotUtils.js` 생성
- [ ] `googleSync.js` 생성
- [ ] `dbUtils.js` 생성
- [ ] `confirmLogic.js` 생성
- [ ] `index.js` 생성: re-export
- [ ] 서버 시작 테스트 확인

---

## P15. utils.js - 클라이언트 (785줄)

**위치**: `client/src/utils.js`

**주요 함수**: speak, formatDate, getWeekday, addDays, addWeeks, startOfWeek, endOfWeek, startOfMonth, endOfMonth, translateEnglishDays, findAvailableTimeSlots, checkScheduleConflict, generateAIPrompt, parseAIResponse

**분할 계획**:
```
utils/
  index.js                 ← 모든 유틸 re-export (기존 import 경로 호환)
  dateUtils.js             ← formatDate, getWeekday, addDays, addWeeks, startOfWeek, endOfWeek, startOfMonth, endOfMonth
  speechUtils.js           ← speak
  translationUtils.js      ← translateEnglishDays
  scheduleUtils.js         ← findAvailableTimeSlots, checkScheduleConflict
  aiPromptUtils.js         ← generateAIPrompt, parseAIResponse
```

### TODO
- [x] `utils/dateUtils.js` 생성: 날짜 관련 8개 함수 이동
- [ ] `utils/speechUtils.js` 생성: speak 함수 이동
- [ ] `utils/translationUtils.js` 생성: translateEnglishDays 이동
- [x] `utils/scheduleUtils.js` 생성: 2개 함수 이동 (기존 utils/scheduleUtils.js와 이름 충돌 확인!)
- [ ] `utils/aiPromptUtils.js` 생성: AI 관련 2개 함수 이동
- [ ] `utils/index.js` 생성: 모든 유틸 re-export
- [ ] 기존 `import { xxx } from './utils'` 경로가 `'./utils/index'`로 자동 해석되는지 확인
- [ ] 빌드 테스트 통과 확인

---

## P16. eventController.js (731줄)

**위치**: `server/controllers/eventController.js`

**주요 함수**: createEvent, getEvents, getEventById, getEventsByRange, updateEvent, deleteEvent, updateEventStatus, findEventByDetails, getConflictingEvents, addParticipant, removeParticipant, updateParticipantStatus, setPriority, duplicateEvent, recommendAlternativeTime, recommendRescheduleTime, confirmReschedule

**분할 계획**:
```
controllers/event/
  index.js                ← module.exports 조합
  crudHandlers.js         ← createEvent, getEvents, getEventById, getEventsByRange, updateEvent, deleteEvent, updateEventStatus, findEventByDetails, duplicateEvent
  participantHandlers.js  ← addParticipant, removeParticipant, updateParticipantStatus
  conflictHandlers.js     ← getConflictingEvents, setPriority
  rescheduleHandlers.js   ← recommendAlternativeTime, recommendRescheduleTime, confirmReschedule
```

### TODO
- [ ] `controllers/event/` 디렉토리 생성
- [ ] `crudHandlers.js` 생성: CRUD 9개 함수 이동
- [ ] `participantHandlers.js` 생성: 참여자 3개 함수 이동
- [ ] `conflictHandlers.js` 생성: 충돌 2개 함수 이동
- [ ] `rescheduleHandlers.js` 생성: 재조정 3개 함수 이동
- [ ] `index.js` 생성: module.exports 조합
- [ ] `server/routes/events.js`의 require 경로 업데이트
- [ ] 서버 시작 테스트 확인

---

## P17. DateDetailModal.js (750줄)

**위치**: `client/src/components/tabs/ScheduleGridSelector/components/DateDetailModal.js`

**분할 계획**:
```
ScheduleGridSelector/components/
  DateDetailModal.js       ← 메인 (import 조합)
  dateDetailModal/
    hooks/useDateDetail.js ← 상태/핸들러
    TimeSlotList.js        ← 시간 슬롯 목록 렌더링
    SlotActionBar.js       ← 슬롯 액션 버튼
    DetailHeader.js        ← 모달 헤더
```

### TODO
- [ ] `dateDetailModal/` 디렉토리 생성
- [ ] `hooks/useDateDetail.js` 생성
- [ ] `TimeSlotList.js` 생성
- [ ] `SlotActionBar.js` 생성
- [ ] `DetailHeader.js` 생성
- [ ] `DateDetailModal.js` 수정: import 조합
- [ ] 빌드 테스트 통과 확인

---

## P18. GroupChat.js (745줄)

**위치**: `client/src/components/chat/GroupChat.js`

**분할 계획**:
```
chat/
  GroupChat.js             ← 메인 (import 조합)
  groupChat/
    hooks/useGroupChat.js  ← 상태/핸들러
    components/
      MessageList.js       ← 메시지 목록 렌더링
      MessageInput.js      ← 메시지 입력 UI
      ChatHeader.js        ← 채팅 헤더
```

### TODO
- [ ] `groupChat/` 디렉토리 생성
- [ ] `hooks/useGroupChat.js` 생성
- [ ] `components/MessageList.js` 생성
- [ ] `components/MessageInput.js` 생성
- [ ] `components/ChatHeader.js` 생성
- [ ] `GroupChat.js` 수정: import 조합
- [ ] 빌드 테스트 통과 확인

---

## P19. SuggestionModal.js (714줄)

**위치**: `client/src/components/chat/SuggestionModal.js`

**분할 계획**:
```
chat/
  SuggestionModal.js       ← 메인 (import 조합)
  suggestionModal/
    hooks/useSuggestion.js ← 상태/핸들러
    components/
      SuggestionList.js    ← 제안 목록 렌더링
      SuggestionCard.js    ← 개별 제안 카드
      ActionButtons.js     ← 수락/거절 버튼
```

### TODO
- [ ] `suggestionModal/` 디렉토리 생성
- [ ] `hooks/useSuggestion.js` 생성
- [ ] `components/SuggestionList.js` 생성
- [ ] `components/SuggestionCard.js` 생성
- [ ] `components/ActionButtons.js` 생성
- [ ] `SuggestionModal.js` 수정: import 조합
- [ ] 빌드 테스트 통과 확인

---

## P20. MobileScheduleView.js (696줄)

**위치**: `client/src/components/mobile/MobileScheduleView.js`

**분할 계획**:
```
mobile/
  MobileScheduleView.js    ← 메인 (import 조합)
  scheduleView/
    hooks/useScheduleView.js ← 상태/데이터 로딩/핸들러
    components/
      ScheduleHeader.js      ← 사이드바 + 헤더
      ScheduleList.js        ← 일정 목록 렌더링
      ScheduleEditForm.js    ← 일정 수정 폼
```

### TODO
- [ ] `scheduleView/` 디렉토리 생성
- [ ] `hooks/useScheduleView.js` 생성
- [ ] `components/ScheduleHeader.js` 생성
- [ ] `components/ScheduleList.js` 생성
- [ ] `components/ScheduleEditForm.js` 생성
- [ ] `MobileScheduleView.js` 수정: import 조합
- [ ] 빌드 테스트 통과 확인

---

## 작업 규칙

### 반드시 지켜야 할 것
1. **절대 코드 삭제 금지** - 파일 분리만 한다
2. **export/import 연결 확인** - 분리 후 기존 참조가 깨지지 않도록 한다
3. **하나의 P 작업 완료 후** 반드시 빌드 테스트 (`npm run build` 또는 서버 시작)
4. **기존 파일의 export 시그니처 유지** - 다른 파일에서 import하는 방식이 바뀌지 않도록
5. **서버 파일은 module.exports 패턴**, 클라이언트는 ES6 import/export 패턴 유지
6. **routes 파일의 require 경로** - 컨트롤러 디렉토리로 변경 시 routes 파일도 업데이트

### 작업 순서 권장
- P1~P4: 가장 큰 파일 (효과 큼, 난이도 중)
- P5~P6: 프롬프트 파일 (가장 쉬움, 텍스트 분리)
- P7~P12: 서버 컨트롤러/서비스 (패턴 동일)
- P13~P16: 서버 유틸/작은 컨트롤러 (쉬움)
- P17~P20: 클라이언트 모달/뷰 (패턴 동일)

### 검증 체크리스트 (매 P 작업 후)
- [ ] `cd client && npx react-scripts build` 경고만 있고 에러 없음
- [ ] `cd server && node index.js` 서버 정상 시작
- [ ] 분리 전후 export 시그니처 동일
- [ ] grep으로 이전 파일 경로 import 검색 → 0건
