# 작업 계획 (2026-02-11)

## 1. 구글 캘린더 삭제 역동기화

### 문제
- 앱 → 구글: 일정 추가/수정/삭제 모두 정상 동작
- 구글 → 앱: 구글 캘린더에서 직접 삭제해도 앱 DB에 그대로 남아있음
- watch webhook, polling 등 역방향 감지 메커니즘이 전혀 없음

### 수정 방안
- 구글 캘린더에서 이벤트 목록을 가져올 때, 앱 DB에 `googleEventId`가 저장된 항목 중 구글에서 삭제된 것을 감지
- 동기화 시점: 달력 페이지 진입 시 / 설정의 동기화 버튼 클릭 시
- 구글에서 삭제된 이벤트 → 앱 DB의 `personalTimes`에서도 제거

### 구현 방식: Pull 기반 동기화 (Polling on Access)
1. 사용자가 달력 열 때 구글 캘린더 이벤트를 가져옴 (기존 로직)
2. 앱 DB의 `personalTimes` 중 `googleEventId`가 있는 항목들을 확인
3. 구글에서 가져온 이벤트 목록에 해당 `googleEventId`가 없으면 → 삭제된 것으로 판단
4. 앱 DB에서도 해당 항목 제거 (또는 플래그 처리)

### 수정 파일
- `server/controllers/calendarController.js` — 역동기화 로직 추가 (syncFromGoogle 또는 기존 fetch에 삭제 감지 추가)
- `server/services/confirmScheduleService.js` — 조율방 확정 일정이 구글에서 삭제된 경우 처리
- `client/src/components/mobile/MobileCalendarView.js` — 달력 진입 시 역동기화 호출

---

## 2. 설정 페이지 개편 + 프로필 연결

### 문제
- "개인정보 수정"이 달력 페이지에 있어서 접근이 직관적이지 않음
- 헤더의 프로필 버튼이 `/mobile/profile`로 이동하는데 해당 라우트가 없음 (깨진 링크)
- 비밀번호 변경, 계정 탈퇴 기능이 UI에서 사라짐

### 수정 방안

#### 2-1. 달력에서 개인정보 수정 버튼 제거 → 설정으로 이동
- `MobileCalendarView.js`에서 "개인정보 수정" 버튼 및 `MobilePersonalInfoEdit` 관련 코드 제거
- `MobileSettings.js`의 "계정정보" 섹션에 개인정보 수정 기능 통합
  - 계정정보 클릭 → `MobilePersonalInfoEdit` 컴포넌트 표시

#### 2-2. 헤더 프로필 버튼 → 설정 페이지로 연결
- `MobileHeader.js`의 프로필 버튼 클릭 → `/mobile/settings`로 이동

#### 2-3. 비밀번호 변경 기능 추가
- `MobileSettings.js`에 비밀번호 변경 섹션 추가
- Firebase Auth `updatePassword()` 사용
- 현재 비밀번호 확인 → 새 비밀번호 입력 → 변경
- 구글 전용 로그인 사용자에게는 숨김 처리

#### 2-4. 계정 탈퇴 기능 복원
- `server/routes/auth.js` — 주석 처리된 `DELETE /delete-account` 라우트 활성화
- `MobileSettings.js` 하단에 "계정 탈퇴" 버튼 추가
- 확인 모달 (CustomAlertModal) → 비밀번호 재입력 → 탈퇴 처리
- 백엔드 `authController.deleteAccount()` 함수는 이미 존재함

### 수정 파일
| 파일 | 작업 |
|------|------|
| `client/src/components/mobile/MobileCalendarView.js` | 개인정보 수정 버튼 제거 |
| `client/src/components/mobile/MobileSettings.js` | 계정정보(개인정보 수정) + 비밀번호 변경 + 탈퇴 추가 |
| `client/src/components/mobile/MobileHeader.js` | 프로필 버튼 → `/mobile/settings` 연결 |
| `server/routes/auth.js` | delete-account 라우트 주석 해제 |

---

## 작업 순서

| 순서 | 작업 | 난이도 |
|------|------|--------|
| 1 | 설정 페이지에 계정정보(개인정보 수정) 통합 | 중 |
| 2 | 헤더 프로필 버튼 연결 수정 | 하 |
| 3 | 달력에서 개인정보 수정 버튼 제거 | 하 |
| 4 | 비밀번호 변경 기능 추가 | 중 |
| 5 | 계정 탈퇴 기능 복원 | 중 |
| 6 | 구글 캘린더 삭제 역동기화 구현 | 상 |
