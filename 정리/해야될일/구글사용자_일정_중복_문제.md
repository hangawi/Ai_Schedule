# êµ¬ê¸€ ì‚¬ìš©ì ì¼ì • ì¤‘ë³µ ë° ë™ê¸°í™” ë¬¸ì œ

## ë°œê²¬ì¼: 2026-02-06
## ìµœì¢… ìˆ˜ì •: 2026-02-06

---

## ë¬¸ì œ 1: ë‚ ì§œ ê³„ì‚° ì˜¤ë¥˜ (ë¯¸í•´ê²°)

### í˜„ìƒ
- ì˜¤ëŠ˜: 2026-02-06 (ê¸ˆìš”ì¼)
- "ë‹¤ìŒ ì£¼ ì›”ìš”ì¼" â†’ 2ì›” 9ì¼ì´ ë§ëŠ”ë° **2ì›” 10ì¼ë¡œ ê³„ì‚°ë¨**

### ì›ì¸
- AI í”„ë¡¬í”„íŠ¸ì—ì„œ "ë‹¤ìŒ ì£¼" ê³„ì‚° ë¡œì§ ì˜¤ë¥˜

### í•´ê²°ë°©ì•ˆ
- `server/prompts/scheduleAnalysis.js`ì—ì„œ ë‚ ì§œ ê³„ì‚° ê·œì¹™ ëª…í™•í™”
- ì˜¤ëŠ˜ ë‚ ì§œì™€ ìš”ì¼ ì •ë³´ë¥¼ í”„ë¡¬í”„íŠ¸ì— ë” ëª…í™•í•˜ê²Œ ì „ë‹¬

### ê´€ë ¨ íŒŒì¼
- `server/prompts/scheduleAnalysis.js`

---

## ë¬¸ì œ 2: extend ì‹œ ë‹¤ë¥¸ ì¼ì •ì„ "ê°™ì€ ê°’"ìœ¼ë¡œ íŒë‹¨ (ë¯¸í•´ê²°)

### í˜„ìƒ
- 2ì›” 10ì¼ ì¼ì •ì´ ì´ë¯¸ 22:00ìœ¼ë¡œ ë³€ê²½ëœ ìƒíƒœ
- 2ì›” 9ì¼ ì¼ì •ì„ 22:00ìœ¼ë¡œ ë³€ê²½í•˜ë ¤ í•¨
- AIê°€ "ì´ë¯¸ ê°™ì€ ê°’"ì´ë¼ë©° ìŠ¤í‚µ

```
[AIë¶„ì„] ì´ë¯¸ ê°™ì€ ê°’ - extend ìŠ¤í‚µ: {
  data: {},
  old: { oldEndTime: '22:00' }  // 2ì›” 10ì¼ ê°’ì„ ì°¸ì¡°í•˜ê³  ìˆìŒ
}
```

### ì›ì¸
- AIê°€ ë°˜í™˜í•œ `targetId`ê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜
- extend ì²˜ë¦¬ ì‹œ ë‚ ì§œë¥¼ ê³ ë ¤í•˜ì§€ ì•Šê³  ë¹„êµ

### í•´ê²°ë°©ì•ˆ
- extend ë¹„êµ ì‹œ ë‚ ì§œë„ í•¨ê»˜ í™•ì¸
- ë˜ëŠ” AI í”„ë¡¬í”„íŠ¸ì—ì„œ targetId ì •í™•ì„± ê°œì„ 

### ê´€ë ¨ íŒŒì¼
- `server/services/aiScheduleService.js` - `handleExtendSchedule()` í•¨ìˆ˜
- `server/prompts/scheduleAnalysis.js`

---

## ë¬¸ì œ 3: êµ¬ê¸€ ì‚¬ìš©ì ì°¸ì„ ì‹œ ì¼ì • ì¤‘ë³µ í‘œì‹œ (âœ… ìµœì¢… í•´ê²°)

### í˜„ìƒ
- êµ¬ê¸€ ì‚¬ìš©ìê°€ ì±„íŒ…ë°©ì—ì„œ **ì°¸ì„** í´ë¦­
- ë‹¬ë ¥ í˜ì´ì§€ì—ì„œ **ë¹¨ê°„ìƒ‰(personalTimes) + ì´ˆë¡ìƒ‰(Google Calendar)** 2ê°œê°€ í‘œì‹œë¨

### 1ì°¨ ì‹œë„ (ì‹¤íŒ¨)
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ `suggestionId`ë¡œ ì¤‘ë³µ í•„í„°ë§ ì‹œë„
- extendedPropertiesê°€ ì‘ë‹µì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ê²½ìš° í•„í„°ë§ ì‹¤íŒ¨

### 2ì°¨ ì‹œë„ (ì‹¤íŒ¨)
- ì œëª©+ë‚ ì§œ+ì‹œê°„ìœ¼ë¡œ ì¤‘ë³µ í•„í„°ë§
- ì—¬ì „íˆ ì„œë²„ì—ì„œ personalTimesì— ì €ì¥í•˜ê³  ìˆì–´ì„œ ì¤‘ë³µ ë°œìƒ

### 3ì°¨ ìˆ˜ì • - ê·¼ë³¸ ì›ì¸ í•´ê²° (2026-02-06) âœ…
**ê·¼ë³¸ ì›ì¸:** êµ¬ê¸€ ì‚¬ìš©ìë„ `user.personalTimes.push()`ê°€ ì‹¤í–‰ë˜ì–´ DBì— ì €ì¥ë¨

**í•´ê²°ì±…:** êµ¬ê¸€ ì‚¬ìš©ìëŠ” Google Calendarì—ë§Œ ì €ì¥, personalTimes ì €ì¥ ìŠ¤í‚µ

**ìˆ˜ì • íŒŒì¼:**
1. `server/services/aiScheduleService.js` - `handleAutoResponse()` í•¨ìˆ˜
2. `server/controllers/chatController.js` - `acceptSuggestion()`, `rejectSuggestion()` í•¨ìˆ˜

**í•µì‹¬ ì½”ë“œ ë³€ê²½:**
```javascript
const isGoogleUser = !!(user.google && user.google.refreshToken);

if (isGoogleUser) {
  // ğŸ†• êµ¬ê¸€ ì‚¬ìš©ì: Google Calendarì—ë§Œ ì €ì¥ (personalTimesì— ì €ì¥ ì•ˆ í•¨)
  await syncToGoogleCalendar(user, newPersonalTime, participantNames);
  userResponse.personalTimeId = null;  // Google Calendarê°€ source of truth
} else {
  // ì¼ë°˜ ì‚¬ìš©ì: personalTimesì— ì €ì¥
  user.personalTimes.push(newPersonalTime);
  await user.save();
  userResponse.personalTimeId = newPersonalTime.id;
}
```

**reject ì‹œì—ë„ ë™ì¼ ë¡œì§:**
```javascript
if (isGoogleUser) {
  // êµ¬ê¸€ ì‚¬ìš©ì: Google Calendarì—ì„œë§Œ ì‚­ì œ (personalTimes ì—†ìŒ)
  await deleteFromGoogleCalendar(user, ptData);
} else if (userResponse.personalTimeId) {
  // ì¼ë°˜ ì‚¬ìš©ì: personalTimesì—ì„œ ì‚­ì œ
  user.personalTimes = user.personalTimes.filter(pt => pt.suggestionId !== suggestionId);
  await user.save();
}
```

### ê´€ë ¨ íŒŒì¼
- `server/services/aiScheduleService.js:614-950` - handleAutoResponse
- `server/controllers/chatController.js:392-549` - acceptSuggestion
- `server/controllers/chatController.js:770-871` - rejectSuggestion
- `server/services/confirmScheduleService.js` - syncToGoogleCalendar, deleteFromGoogleCalendar

---

## ë¬¸ì œ 4: ì‹œê°„ í•´ì„ ëª¨í˜¸ì„± (ë¯¸í•´ê²°)

### í˜„ìƒ
- "10ì‹œê¹Œì§€ ë†€ì" â†’ ì˜¤ì „ 10ì‹œ(10:00)ë¡œ í•´ì„
- ì»¨í…ìŠ¤íŠ¸(ì˜¤í›„ 2ì‹œ ì‹œì‘)ë¥¼ ê³ ë ¤í•˜ë©´ 22:00ì´ì–´ì•¼ í•¨

### í•´ê²°ë°©ì•ˆ
- í”„ë¡¬í”„íŠ¸ ê°œì„ : ì‹œì‘ ì‹œê°„ì´ ì˜¤í›„ë©´ ì¢…ë£Œ ì‹œê°„ë„ ì˜¤í›„ë¡œ ì¶”ì •

### ê´€ë ¨ íŒŒì¼
- `server/prompts/scheduleAnalysis.js`

---

## ì™„ë£Œëœ ì‘ì—… (2026-02-06)

### ê±°ì ˆ ì‹œ Google Calendar ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€
- `server/services/confirmScheduleService.js` - `deleteFromGoogleCalendar()` í•¨ìˆ˜ ì¶”ê°€
- `server/services/aiScheduleService.js` - reject ì‹œ GCal ì‚­ì œ í˜¸ì¶œ
- `server/controllers/chatController.js` - rejectSuggestionì—ì„œ GCal ì‚­ì œ í˜¸ì¶œ

---

## ìš°ì„ ìˆœìœ„

| ìˆœìœ„ | ë¬¸ì œ | ì‹¬ê°ë„ | ìƒíƒœ |
|------|------|--------|------|
| 1 | êµ¬ê¸€ ì‚¬ìš©ì ì¤‘ë³µ í‘œì‹œ | ë†’ìŒ | âœ… ìµœì¢… í•´ê²° (3ì°¨) |
| 2 | extend "ê°™ì€ ê°’" ì˜¤íŒ | ì¤‘ê°„ | ë¯¸í•´ê²° |
| 3 | ë‚ ì§œ ê³„ì‚° ì˜¤ë¥˜ | ì¤‘ê°„ | ë¯¸í•´ê²° |
| 4 | ì‹œê°„ í•´ì„ ëª¨í˜¸ì„± | ë‚®ìŒ | ë¯¸í•´ê²° |
